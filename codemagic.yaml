# Automatically generated on 2022-06-22 UTC from https://codemagic.io/app/61f5d70bdd2148c3ff88c82c/settings
# Note that this configuration is not an exact match to UI settings. Review and adjust as necessary.

workflows:
  flutter-build-&-test:
    name: Flutter build & test
    max_build_duration: 30
    environment:
      vars:
        KEYS: Encrypted(Z0FBQUFBQmlzNHVsenhoZnpNZXctUFNkN3g3X3hXNldabmZvT2FKSEkyRmt1dXVLU21zNDNzNGtLa3B6ZlRfZUZLekFOcGcyYndFMkh5X3JUN25Jdy1IMks3Y1FXTmZIVXlQUFlkWEtwd3NWaHhqQU82cjg0Q3FrUW8zcjVvVmZnWkFlNk4xZVVob2pnTlUtSG1OdTZCbHR5SHI1T2x3dUJ0SGpnNGVMU0R4cC12OU82anRTdDUyRjZDRUotcUJBckV4Nlg4MDV6dnpyelVSOFU1cV9adHVPSG5yR1ZDRk5GQmd6aTk4TnpmZl9ybmVwSGI3X3VQem4yWjg1bTVnTGFPTEVpX2phcDNYMUprTkt1U3hLd3puZGlnYjN6WkUtTGJnUGxYUlBjYjJyRXpXSUxBdXJGaDdYQXRpWFhSS1g1a2FkNDhUMi1GYS1hVTF2Ynd0dWpwU1l5Z3JTVzdmdnM3QTV4N1pHcFpJNEFCRVpObXV3SDlLTzFPczdjSGo5MzBvYVQ3bThnQ09mX0JiWmJiZGJXN3dMLWJnMDRrZjZiZmtMSGl5Vlg3dU9PSlZuR2xHd1hleGcyVmFQQ3dPSm92dVQ3eVNsMXJGNm1hZFVsVFhBdzJqMFVLMktsbmRNTlQ4Wk53TG5GdHVoNFJXZkwzczBiRkY1bXdaVmNJWXVhU0stMzlPY0ZsRlZfMGZfcWh1b250VG5uLWRiZ3BBa25uZWtGS080aGw0eDliY2steTA2S3RlNXpWaEcyaHI4YmJicU00WGMxMmVubkhtMUVqYkJmbnRSUmNaRjVuM2tuYnpUVlZPOGFCOFpDU0hoUzV0bWpRWDZZQzFaZXl4dVZCdWo5aklDOHd4ZjZkeTlxRUM5VDFnXzZoNzlUN3BfQTl6el95eEFmX2UwYUJlOHEySmttYkFmdTkyUHgtZDdPOVE1VFRLOVhnSDlCalBlRVI0UERWcGZrWmlXUTBISDRWc3NpMmFSSXFNU20zZDZXYTByY0hlYUFoYldsSk1hZFBQMU1VWmxaOTA5by1feDZLRWtUX0oyZnU5dE5IM3JuZFpwTHBFb2JtVUtuazhKaXFqMFcxbFV5aUlRNVdSeG05QUt1T2FiR1lrdTdsRWM5V1BHZFhKWDFMb3lWZTB5QXNtMWNhT1BjN2JvUTROZnNrZ0k3WFhDXzF2d2ZTWXZzMHoyWTNyT005MEFOVDN4M2FnaGhYMVVYZEZqaDREVnRENi01NXBYeE5HWVhZZG5IQ1FaYUYxTWVQOUZDZzB3dkNPWURpdXVOMXdjQ0kwOHpEZjVBcGpoSm9aYTQyU2pEV19tRVV1Qi01R1hWdlVJeWItZkRuQnVlMUhEVWk0dS1DU2c4MEktSDFTcnZnb0N3b2FNQkl2cEZLVldkYXNxYnRZSjhZcU9tTzhfRjk5cVF4eXZIcGg3Rml1ZUVuZERHRFhOQ2gtRXlTSVJObmtFbUo5SnluRHQ1UG5nRWtkel9aRWVxQl9oYXU2UXkxb3hkV3VWXzRyWEt5T1hvZzN4NjZBU2w1cVZFZlBuaE41WUFjak41ZUE0UHlOTE5OYWx1Tjd4SzQ0RUlybDZMdGFiaW85dklRaEZxeGllUTUwS1Vaa1hxN0g0SFdFVWYxdFlVRVI3R1d2OThvZmduTlFXRkR3NEhTRXlaTEZSQmNMczY4WkJqdFNsd0ZHWEJxZWdLYUw4S0pTZEZ0YUdBY1FMdUphT0tmWE9kSENVXzZsMHlYd0VFR1U3MklOdDQta255elFPZEFRbVVBbVltZXI4Q1ZzTmpCX05NU09VNm12SGZQSlplcFBkYlVmU0dpcVdhYnpaM0RjWWZLbUJBNUJ0bHI0d2NGS20yeXE3TGZDZTNESl9hZ200UFZKUjhXdm1NSjNvUTVBelpBc2hRLTBMVlZySzNVSFcxeFpOMWhWdVdITXFPdHlkSWhadmlrZWF6R3ZjdThWSEx2ZFZTallFQnFaYUVvMFZUSUdIVDN4Zms0SWVtamFoU3laQVh4S2VJQjhfMjcyOFBzMFF4MmpmMV8tODdYNUJ5LThDNi1HcmtaWWdCM2k2dTZDMGprdVVGUnZpeXNwZTgtRGRSU0RVa2otYjJXdTltUXpHbE9WSjV6Y2RBZ3ZTc2ZaOFp3NGF3cGNMcUthbWhFMHJ1X3FkMF8yNVk4Y1FPQ2lEbmNqRUFfOHczeXAzWW5leUdlZVk2RVl0c0FpUW4xeEtMZnVqZGJKdzVnTnBERC1JLU5iY1ZuUllPVXo0WkdESTR2LUZOSER2V1VwV1gwbFpHSXJUejlabUFodVJDbnYyaFJDWnRBcGJINkVpWHg2Vm5hVlFXVjlRcjJmUHpySmJHWjRMRmJ5dEVvdTY4ai0zdlZnSEljZFlPdlhlM1VsR0hacUNoX1IwdlVfRXBwSFN1ZWJtOTNpQjUteERxcGJoZHJxOG55VTJxMjd4cDhZcEJQbjhvY0h1djFCS2tzVWpqeldYZDI5cmI0NDNoUXpnMXVpZE4xaW5qX0dyYlI3TVRtbE5lc2txNU84ZV9YdkJBcmJleGlreDdjMEtnVGlUM1FwbEpuM2lNbUEyY1RudXM5bjJ1QVVtblZ3WXVudzRObWhmLVhNbUgyVnpWb280RDZyZlNUS3RMRUNYLUdOYlBrdEhjUjNQU3BjWWxmRjU0dDBtZ1RmcFd0OG10Vzc4c1ZSeE0yWTBZbkt0OTRkV3JjVUszbVhzaUoxVndRdFhmNl9mVjM2OWdYT01oYVlWNzQ4bDFFUXlpTVpvV1FLVFo3dVRNMmxDZ3Ziak4zSzBWazFZaVdma2FsbDFjdFE4RDYxVXoxclRpTlkxY1dHQ3pNVUE4ZDA0UUkxMUpHT1VCektrcjdDZ2xmRVdWOTlqcHpKWldqMVJiYThfSnFsR0dyQ2VpczM5dFlFYks0MC1qSFJBVElrWUtJeU1QdUI5Wi1JdjlYdEdadENjVlhiaXRKYnE5eHNCU0VfeWptbW5rWnpjdDNPRFpIRTRzZHp0RjJpdGZqcjhKUVhSWmFzbkZOSnBRbnJRTGJrT3ZqWUlhQzZ6bTFrSjlWd1NLVXhEN2V4bEJCdmQtVC1iSWlwcTc1QmxKbXEwbVZFcEdwbkxEcWFtend2YjFiNXZuT0pZaENUSGtRc2Zyd010WjBpUEk1eEtlSmxydW1MVDVlMzl4NFNWOFZKM0F1c0NVd1pQVkJDVFlpQzk0SWxVeHREdUp4djlFZEpiTHdXaklLbzhlNklwb084a2p4WFhhYXp1aXpxeWRibzhoMHFlXzJyOGRROUljaGdIMHl0MDVsRnZKOEtnbUJ1bFFrU2IxRmxGelkyMlVZVkJsM1piQVphbExLRjg3bm9KSmFpVWxQT3VCcnZNMWlWazN6RXhhejBxM1lsWnkzUzJLSlBUaGdMTzMtTmNfMTNwRFRFbWNWdWVBVWVPdjJZek9Fb1pscENoOW9FQnAxSDZ3ZXB4ZWEzSXlmRjRuRnBfRFV3SnN1UUNCVTZXdDEzWjJxQk01dEM2SThOamE2c1ZFdHNqUmVkVG1fMnNHckVIWEt2bEd4b1kzVUhrVWx3c0pLWkE4M3F1T3NWcXpkN3JlNTFuSXhhb29vV0c0cVpuVExuamxkV05reGR4bkpzVDlEMkxwWnBFYW12V0dSOVIxel9Zd2tuWXczaGc2SEZyMWEyNld4NDdueG01cXJwMlJGVzNDVHlCZlNPcmozcllqQk1XdzI5aS1pQjNkd1VQRnB3U0E0R19wMTJDcThiTU0yZXUzaGhMclBSX2Z3RldHeDk4QV9mTE1odEZidkJtUWpoZXdVYnZDWUZpNHlyZ1VGS2dwZDJ6WDB6YmM1eXROODNmenFJT3JTTGtJdGRyT202UmQ1Nk9XNFpSMFVFQlFOVmZQSTNjcWJlekpXVk53MzNiRUNxczB5UFFxQ0tfVk8zc2t4WnU0bEFrOVJXVmZkTlhvYjBDNDFGbUI5d21aMXYwdUxyMjlLZzl0cV8xWGtuT0F2NkFYd3FlUVFweEpfV0hCMng3WU53RndOeEx3SjV1U3JzbFppSTBxbWJGWk8ySnZoWjZrakVYb2Y2VUZGUVZfTnhDZC1iRzA2ZUFsS2ZGS09CcWtjMlVRQmJOMkdDaU1Gc0U4QThLSExYWmVINW9NRWVQeGRIR2VwR1NsVC0yaWNId0Z1a093NzdhS29ZekRyaUZfWVBGTWE0YTgwTWZRWGZTaHBFTU9mSS1QaW1MU01aTGEzV2xvQ0RZQWJ5MzFKelhsNjZPV05RZ0FHdFhKOWRBaWlxdUFJUjRNcmlJVTBpa2V6Rm5KY190T0w2R3BmVVd2Y19aejdndTJVVDJSX1A5SW54QXBWSUw5VEhHbjMxZnQ4TE81MnR5RC1UNldTMGY2TjJwN0hnVHVDQk5wQ09oZ2FNQWthVFBXUjB4OHBPeF9WTDM3ZmRfVWhseDNWOXM0ZGRMeV9GNWRSd1FUYW1QQTYxN1RZOWJCQlJxdXNaX0dQd0FDak1wdHEyZF9lRmVGTFFnSVkxUkxkVWNjell3b09uSkpPOWFrUmRtWlZCeHRjYTdrUkVpMlBNMW4xR2tNU2staHItTWNOcEt1My00VDhsak50ZGN5WE9KMDB2dUIycGU2WWZXTndwQ1pRSGg2bnF6WTctaVhjc0NkWUdleG0yQTZwcnUtV2lzUi1VV25teU5UUE91b01Cc1huMUotYmR4Qm1WTWt2RTEyQXdzSWlXaDFKVW5SampyRnRkcjVob2dMbFE1aF9iUDJzUTdvMTV2VzdXc1AxRjMwU1VUTTZRR0RpUW1PTndxcTlQOTA2SHMyLVF1dmdaR0VkWlUwMlNUaXdlUm9NbEw4QkhNMG1vWHNkdUw3cFJESFk3alpxaVZYU1NRbXgxRXNEc1pxdXYxUXBqb2JnbU9rUDZ4Z2JYY0EwTU0wUExHZTlWVUdEM2FpQWs1ZEduSXVoLVFJekJMV0ZzMm9vZVZDVW1ZWEgwU1V3OHpUWUJEQ0hnYmxvV3Nwb3ctU3o1ZXhTbkgzQ1JSRG91YzNNNlpYWWlfZlJqRmc4TEhOeGVoeGd3akxHT0VyMEJUbTNTTjhiTkNhcW1Xd1h5SFhtajJxQ2UyZ1k5SHJvVk5DV1BTSmJJOHVGVzlMSDBlV1BPYUhjSzZzazhNMjZtSkNTLTM0SEZnZi1qZEVBS0NyaGEwRDBzWkR4cUxka1J6VGFuUDBHUjA4b1JxcUZwNTl0cEdWX0w3TENZSEZtU2VJcTFvRW9TNWFrMFlDdVNVRFhMUWZBTEFpX0NhYmxmNjFLTzZsUDUxdVAtQ3ozeXNEYTNfUUl6NHBDbWxHRlRraEVROWRIR1pqaTBRZk5mQTV4cUY2eW4xeFFTMDF4MXhvNldlZHhYR0Q0NHV4bTB3U1gtVVREb2tYNWtaRW80YkhjY3ZIU0lGNnozTDBxZERiWWxobURVUzVBOGplYjlYVTUxRlJHaFZWME9mU0JrTUhWRTI1YWJHcVh2NV9TUlRpdkpibVdwRXE2NFR3TW5oRmRwdkVBT003ZXVmTDNmQTd5MVYzSDhpRWpHeWNOWG56czZMLUZrcTBLWUNJNHVLcGN4VklzN3RjbHZhMFVSVWRQdVFjdDRWTWtwMUhneEJRbDAwQjBNQTc5T25ibHExbGZvWjdLVWNnU1BVNVdncXBNaWtPUVhKdTczaGxuaXJGdERRVTFUeFR2ZVBtRldyeEJncUhfT1hxLVRhSlJaSzU0QUJ2UkV0LS1fYXA2UTdNSl9fWnFHTFhycm5sbjZhTTBDSWlzTDBOWXlnZmw2azBSUkNrMGpXWVM0SDVYVEsyV25UbWxWOU1kUzQ2ZDUyTmRGQ00xajVVczZqZVNtZ2ZGRU9pdkIyQUV3cDZxSEY1NDluQzdkZm54QlExLWZTRzFFN0JRU1RjOE5McVZ0SjBITV8wc2RhbThkcGJTSkNuQ2NVdHRoLTFtYUttQ01GVTF5U1BYOUM0MTMwd0IxQi11Sk5kVEtlMXBBaHNGd2RYQkZieG9ZemZyc3dKQkNjUzNUX0t0UWYwQ1N5LWs5cWdGMzFkbHNrRGd5TlRicHc0RnprMDBfMktpS1F0RkpYZjZ2RG1XRUp4SUdKT3NZSHVPVjY2T0k1WGVsZGs4MGV0T2RKUktqWnRlMC1iZGtRWlg1U2lTLXFPWllrZERMWVgyai1hVFFtV2ZjQlJGU2RMM1FxSjZWUktRYmg0QlJpd0M5MGNQWEJ1MWluWmVUUThsNktTLTdlZ01RYWpRcTByRjAwZk5iTEdVOGxfQWRjdU1obWxRTUEwUVZsNEpSYWdUYXB2N0Rid1JnaVM3Qkk2N2czcjc0VWhiM0p4ZVlLbzBVcmpjOEsxVGhpTDVCQS1jZmowQ1Exa3NjM2w3RnFJT0pPYXJRTGVPMU5tXzJGUDRlR2hJRDlTWjViNTl6UjZ5b1JoOG5BWHpsdGpwVVhnMms1bzdMa2lmRGhMNHczbnBidllhRmRGNllrdFUwN1AyUGJtaVZFOWZEbWlpbmR6dWNyOEdMdjRDZXNmR290MGt6OWtwMW1UMGhfQXg2ODF4UGVZWlpaLUM5MkExakQtYk1DLTJVY1IwQ05oS25ZWUFYVXZyZHdnMjliVnRRQnBQTmJOd1QyVjY1cWVycDdHbldQdlRFcmQwVHVKa3lzVFZTNUhpQTEtdnliSEVUdkF6MlRDbmZvR3A5amNZR3doczlrU19DZHNVQVd5T25TSTNtNVhSSHlNNW50NkVtalB2b095Zk54dDNyc1FJZTR0dFoxd1BKbXFBMnQwOHhncGFMRkhqLUEyYWlDY1ppZFJzVkVuUllDb29wQVpzTjVyZ0xncnJ3YmRCUW15b29MNXdPS3VDSlVjenNweVBYaExYOGF3aUxRRVlleF9qTllHdm4zNHVnY1FGb3RrMG5jT1Itd0NUdDdzTFlzejZiSl9WNkVfYnNMSTNXWmxla3hGRGZzWmZDZ2c0WEQwR01IVDdkbFBjeGdUOVNjbVVjY3NSMGRnUVRqbFJHY1JTX2k5UEhYcWowS21oOWpJRE9PUEhLQXlXX2UwQVFDcGpodnhfRUNXbUVIb3pyTTFoYlN3ZHFJUXl1a0lpZ28wd0d2YndjPQ==)
      flutter: stable
      xcode: latest
      cocoapods: default
    triggering:
      events:
        - push
        - pull_request
      branch_patterns:
        - pattern: '*'
          include: true
          source: true
      tag_patterns:
        - pattern: '*'
          include: true
    scripts:
      - |
        # set up debug keystore
        rm -f ~/.android/debug.keystore
        keytool -genkeypair \
          -alias androiddebugkey \
          -keypass android \
          -keystore ~/.android/debug.keystore \
          -storepass android \
          -dname 'CN=Android Debug,O=Android,C=US' \
          -keyalg 'RSA' \
          -keysize 2048 \
          -validity 10000
      - |
        # set up local properties
        echo "flutter.sdk=$HOME/programs/flutter" > "$FCI_BUILD_DIR/android/local.properties"
      - flutter packages pub get
      - cd shared/ld_ui
      - flutter pub get
      - |
        #!/bin/sh
        mkdir -p $FCI_BUILD_DIR/lib/secrets
        echo $KEYS | base64 --decode > $FCI_BUILD_DIR/lib/secrets/keys.dart
      - flutter analyze
      - flutter test
      - flutter build appbundle --release
      - |
        # generate universal apk signed with debug key
        android-app-bundle build-universal-apk \
          --bundle build/**/outputs/**/*.aab \
          --ks ~/.android/debug.keystore \
          --ks-pass android \
          --ks-key-alias androiddebugkey \
          --key-pass android
    artifacts:
      - build/**/outputs/apk/**/*.apk
      - build/**/outputs/bundle/**/*.aab
      - build/**/outputs/**/mapping.txt
      - '*.snap'
      - build/windows/**/*.msix
      - flutter_drive.log
    publishing:
      email:
        recipients:
          - bk.koluch+codemagic@gmail.com
